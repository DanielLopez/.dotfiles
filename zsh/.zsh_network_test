#******************************************************************************
# Network Connectivity Test Script
# Tests specific host:port combinations using netcat
#
# Format for detlare statement.	
#      "label|host:port"
#
# -[EXAMPLE]-------------------------------------
# declare -a NETWORK_TEST_TARGETS=(
# 	"Google Host|www.google.com:8080"
# )
#******************************************************************************
function nt(){
    RED='\033[0;31m'
    GREEN='\033[0;32m'
    YELLOW='\033[1;33m'
    BLUE='\033[1;34m'
    PURPLE='\033[38;5;129m'
    PINK='\033[38;5;213m'
    NC='\033[0m' # No Color

    # Colors for output
    # Load targets from external file
    local targets_file="${HOME}/.zsh_network_test_targets"

    if [[ ! -f "$targets_file" ]]; then
        echo -e "${RED}Error: Targets file not found at $targets_file${NC}"
        echo "Please create the file with NETWORK_TEST_TARGETS array."
        return 1
    fi

    #Unset the Enviornment Variable to ensure it will load each time.
    unset NETWORK_TEST_TARGETS

    # Source the targets file
    source "$targets_file"

    # Check if array was loaded
    if [[ ${#NETWORK_TEST_TARGETS[@]} -eq 0 ]]; then
        echo -e "${RED}Error: No targets found in $targets_file${NC}"
        return 1
    fi


    echo "=============================="
    echo "Starting connectivity tests..."
    echo "=============================="

    # Loop through each target
    for target in "${NETWORK_TEST_TARGETS[@]}"; do
	# Split host, port, and label
	label="${target%%|*}"     # Get everything before first "|"
	temp="${target#*|}"       # Remove label and first "|"
	host="${temp%%:*}"        # Get everything before last ":"
	port="${temp##*:}"        # Get everything after last ":"

	printf "${PINK}[$label]${NC} ${BLUE}$host${NC}:${YELLOW}$port${NC} ... "

	# Perform netcat test with timeout of 3 seconds
	if nc -zv -w3 "$host" "$port" 2>/dev/null; then
	    echo -e "${GREEN}OPEN${NC}"
	else
	    echo -e "${RED}CLOSED/FILTERED${NC}"
	fi
    done

    echo -e "\n${NC}Connectivity tests completed.${NC}"
}
